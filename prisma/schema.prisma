generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String   @id @default(cuid())
  name                String?
  email               String   @unique
  emailVerified       Boolean  @default(false)
  phoneNumber         String?  @unique
  phoneNumberVerified Boolean  @default(false)
  image               String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  sessions Session[]
  accounts Account[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  idToken               String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// ==========================================
// DASHBOARD MODELS - Cabinet Medical
// ==========================================

model Patient {
  id                String    @id @default(cuid())
  nom               String
  prenom            String
  email             String    @unique
  telephone         String
  dateNaissance     DateTime
  adresse           String?
  complementAdresse String?
  ville             String?
  codePostal        String?
  numeroSecu        String?
  demandes          Demande[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model Demande {
  id        String  @id @default(cuid())
  patientId String
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  // Type de soin
  typeSoin    String // Ex: "Pansement", "Injection", "Prélèvement", etc.
  description String? @db.Text // Description complète (JSON) avec tous les détails

  // Rendez-vous
  dateRdv  DateTime?
  heureRdv String? // Ex: "9h00", "14h30"
  lieu     String? // Adresse du rendez-vous

  // Urgence et statut
  urgence Urgence @default(NORMALE)
  statut  Statut  @default(EN_ATTENTE)

  // Notes supplémentaires
  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Modèle pour les statistiques de planning
model PlanningStats {
  id String @id @default(cuid())

  // Période
  date DateTime @unique // Date unique pour chaque jour
  type String // "jour", "semaine", "mois"

  // Compteurs
  totalPatients         Int @default(0)
  patientsAujourdhui    Int @default(0)
  patientsCetteSemaine  Int @default(0)
  patientsCeMois        Int @default(0)

  // Métadonnées
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Urgence {
  FAIBLE
  NORMALE
  ELEVEE
  URGENTE
}

enum Statut {
  EN_ATTENTE
  CONFIRMEE
  EN_COURS
  TERMINEE
  ANNULEE
}
